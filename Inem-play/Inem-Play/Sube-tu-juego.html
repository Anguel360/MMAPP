<!DOCTYPE html>
<html lang="es-en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Inem Play</title>
        <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-storage.js"></script>
        <script type="module" src="firebaseconect.js"></script>
        <script src="main.js"></script>
        <script src="subirjuego.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
        <link rel="stylesheet" href="/Inem-Play/css/main.css">
    </head>

<body>
           <header>
           <i class="bi bi-arrow-bar-up" style="color: #ffffff;"> Sube tu Juego</i>
           <button id="abrir" class="abrir-menu"><i class="bi bi-list"></i></button>
           <nav class="nav" id="nav">
             <button class="cerrar-menu" id="cerrar"><i class="bi bi-x"></i></button>
             <ul class="nav-list">
                <li><a href="/Inem-Play/init.html">Inicio</a></li>
                <li><a href="/Inem-Play/Categorias.html">Categorias</a></li>
                <li><a href="/Inem-Play/Sube-tu-juego.html">Sube tu juego</a></li>
                <li><a href="/Inem-Play/Usuario.html">Usuario</a></li>
                <li><a href="https://web.facebook.com/profile.php?id=100071401742176">Asistente</a></li>
             </ul>
           </nav>
           </header>
        
        
        <div class="container-upload">
            <div class="imageUpload">
                <input type="file" class="inp" onchange="getImageData(event)" multiple />
                <button onclick="selectImage()" class="selectImage">Select Images</button>
                <div class="metaData"></div>
                <div class="progressBar">
                  <div class="progress"></div>
                </div>
                <button onclick="uploadImage()" class="upload">Upload</button>
                <span class="completeMsg"></span>
                <span class="loading">Loading...</span>
                <div class="images"></div>
              </div>
              <script>


                 import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
                 import { storage } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-storage.js";
                 
                const firebaseConfig = {
                   apiKey: "AIzaSyB0SVG5NtzOGvKHtRhjLb8P0MEIRPdexaY",
                   authDomain: "inem-play-nube-75ead.firebaseapp.com",
                   projectId: "inem-play-nube-75ead",
                   storageBucket: "inem-play-nube-75ead.appspot.com",
                   messagingSenderId: "290494209807",
                   appId: "1:290494209807:web:b959d73e59e86cebc0a87a",
                   measurementId: "G-LQQXJZ4NXZ"
                };
          
                const app = firebase.initializeApp(firebaseConfig);
          
                const storage = firebase.storage();
          
                const inp = document.querySelector(".inp");
                const progressbar = document.querySelector(".progress");
                const img = document.querySelector(".img");
                const body = document.querySelector("body");
                const metaData = document.querySelector(".metaData");
                const images = document.querySelector(".images");
                const loading = document.querySelector(".loading");
                const imageUpload = document.querySelector(".imageUpload");
                const completeMsg = document.querySelector(".completeMsg");
                let file;
                let files;
                let fileName;
                let progress;
                let uploadedFileName;
                const selectImage = () => {
                  inp.click();
                };
                const getImageData = (e) => {
                  files = e.target.files;
                  for (let i = 0; i < files.length; i++) {
                      let imageData =  document.createElement("span");
                      imageData.className ='filedata';
                      imageData.style.display ='block';
                      imageData.innerHTML = files[i].name;
                      metaData.appendChild(imageData);
                  }
                };
          
                const uploadImage = async () => {
                  for (let i = 0; i < files.length; i++) {
                      let url = await uploadProcess(files[i],Math.round(Math.random()*9999) +files[i].name);
                      if(url){
                          loading.style.display='none';
                          let image = document.createElement("img");
                          image.style.display='block';
                          image.setAttribute('src',url);
                          image.className ='img';
                          images.appendChild(image);
                      }
                      if(i===files.length-1){
                          completeMsg.innerHTML = `${files.length} files uploaded successfully`;
                      }
                  }
                };
          
                const uploadProcess = (file, fileName) => {
                  return new Promise((resolve, reject) => {
                    const storageRef = storage.ref().child("myimages");
                    const folderRef = storageRef.child(fileName);
                    const uploadtask = folderRef.put(file);
                    uploadtask.on(
                      "state_changed",
                      (snapshot) => {
                          loading.style.display='block';
                        progress =
                          (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        progress = Math.round(progress);
                        progressbar.style.width = progress + "%";
                        progressbar.innerHTML = progress + "%";
                        uploadedFileName = snapshot.ref.name;
                      },
                      (error) => {
                        reject(error);
                      },
                      () => {
                        storage
                          .ref("myimages")
                          .child(uploadedFileName)
                          .getDownloadURL()
                          .then((url) => {
                            console.log("URL", url);
                            resolve(url);
                          });
                      }
                    );
                  });
                };
                </script>
      </div>

</body>
</html>